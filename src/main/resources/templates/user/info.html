<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="~{layout/layout}">
      
	<th:block layout:fragment="content">
		<script type="text/javascript">
	    	$(function() {
	    		if (typeof window.klaytn !== 'undefined') {
	    			$(".connectKaikasBtn").show();
	    		} else {
	    			$(".kaikasUnconnectable").show();
	    		}
	    		
	    		klaytn.on('accountsChanged', function(accounts) {
	        		var selectedAddress = accounts[0];
	        		if (selectedAddress) {
	        			
	        			if ($(".connectKaikasBtn").length > 0) {
	        				console.log('?')
	        				var maskingAddress = selectedAddress.substring(0, 6) + "******" + selectedAddress.substring(36, 42);
		        			$(".connectKaikasBtn").text(maskingAddress + " 지갑 연결");	
		        			walletConnect(selectedAddress);
	        			}
		        	}
	        	})
	    	});
	    	
	    	function connectKaikas() {
	    		if (typeof window.klaytn !== 'undefined') {
		       	  	const provider = window['klaytn']
		       	  	
		        	try {
		        	  const accounts = klaytn.enable()
		        	  var selectedAddress = (klaytn.selectedAddress);
		        	  if (selectedAddress) {
		        		  walletConnect(selectedAddress);
		        	  }
		        	  // You now have an array of accounts!
		        	  // Currently only one:
		        	  // ['0xFDEa65C8e26263F6d9A1B5de9555D2931A33b825']
		        	} catch (error) {
		        	  // Handle error. Likely the user rejected the login
		        	  console.error(error)
		        	}
			        	
		        	
		       	}
	    	}
		</script>
		<div class="infoWrap">
			<div class="userInfoWrap">
				<div>
					<img class="profileImgUrl" th:src="${ user.profileImgUrl }"/>
				</div>
				<div class="basicUserInfoWrap">
					<h3 th:text="${ user.name }"></h3>
					<div><span th:text="${ user.regDate }"></span></div>
					<div th:if="${ user.walletAddress != null }"><span th:text="${ user.walletAddress }"></span></div>
					<div th:if="${ user.walletAddress == null }">
						<a class="connectKaikasBtn" href="javascript:connectKaikas()">카이카스 지갑 연결</a>
						<em class="kaikasUnconnectable">* 지갑을 연결할 수 없습니다<br/>(카이카스 연결이 가능한 브라우저로 접속해주세요.)</em>
					</div>
				</div>
			</div>
			
			
			<div class="tokenInfoWrap" style="padding:30px 0 0 0;">
					<h1>MY MTDZ</h1>
			        <div th:if="${ user.walletAddress != null && collectList != null && collectList.size > 0 }">
			            <ul class="tokenItemWrap">
			            	<th:block th:each="token : ${collectList}">
			            		<th:block th:include="token/include/item"></th:block>
			            	</th:block>
			            </ul>
			        </div>
			        <div class="emptyWrap" th:if="${ user.walletAddress == null }">
			        	카이카스 지갑을 연결해주세요.
			        </div>
			        <div class="emptyWrap" th:if="${ user.walletAddress != null && (collectList == null || collectList.size == 0) }">
			        	보유하고 있는 메토드가 없습니다.
			        </div>
			    </div>
		</div>
	</th:block>
</html>